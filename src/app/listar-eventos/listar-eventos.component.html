<div class="listar-eventos-container">
  <h2>Tus Eventos</h2>

  <div *ngIf="error" class="alert alert-danger" role="alert">
    {{ error }}
  </div>


  <div *ngIf="eventos.length === 0; else eventList">
    <p>No tienes eventos creados.</p>
  </div>

  <ng-template #eventList>
    <table>
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Descripción</th>
          <th>Fecha Inicio</th>
          <th>Fecha Fin</th>
          <th>Tipo</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let evento of eventos">
          <tr (click)="toggleEvento(evento)" class="evento-row">
            <td>{{ evento.nombre }}</td>
            <td>{{ evento.descripcion }}</td>
            <td>{{ evento.fechaInicio | date:'short' }}</td>
            <td>{{ evento.fechaFin | date:'short' }}</td>
            <td>{{ evento.tipoEvento }}</td>
            <td>{{ evento.estado?.nombre }}</td>
            <td>
              <button *ngIf="eventoEditandoEstado?.idEvento !== evento.idEvento" (click)="iniciarEdicionEstado(evento)">
                Cambiar Estado
              </button>
            </td>
          </tr>

          <tr *ngIf="eventoExpandido === evento" class="detalles-row">
            <td colspan="7">
              <div class="detalles-panel">
                <p><strong>Organizador:</strong> {{ evento.organizador?.nombre }} ({{ evento.organizador?.correo }})</p>
                <p><strong>Ubicación:</strong> {{ evento.ubicacion?.direccion }}, {{ evento.ubicacion?.ciudad }}, {{ evento.ubicacion?.pais }}</p>
                <p><strong>Stock General:</strong> {{ evento.stockGeneral }}</p>

                <div *ngIf="eventoEditandoEstado?.idEvento === evento.idEvento">
                  <label for="estadoSelect">Cambiar Estado:</label>
                  <select id="estadoSelect" [(ngModel)]="nuevoEstadoSeleccionado">
                    <option *ngFor="let estado of estados" [value]="estado.idEstadoEvento">
                      {{ estado.nombre }}
                    </option>
                  </select>
                  <button (click)="guardarEstado()">Guardar</button>
                  <button (click)="cancelarEdicionEstado()">Cancelar</button>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </ng-template>

  <!-- Botón flotante para crear evento -->
  <button class="boton-flotante" (click)="irCrearEvento()" title="Crear evento">
    <span>+</span>
  </button>
</div>